document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("mechanicsGrid");["charizard","pikachu","gardevoir","snorlax"].forEach((t=>{fetch(`https://pokeapi.co/api/v2/pokemon/${t}`).then((e=>e.json())).then((n=>{const a=document.createElement("div");var o;a.classList.add("mechanic-card"),a.innerHTML=`\n            <img src="${n.sprites.other["official-artwork"].front_default}" alt="${t}" class="poke-art">\n            <h3>${o=n.name,o.charAt(0).toUpperCase()+o.slice(1)}</h3>\n            <div class="stat-list">\n              ${n.stats.map((e=>{const t=function(e){return{hp:"HP",attack:"Attack",defense:"Defense","special-attack":"Sp. Atk","special-defense":"Sp. Def",speed:"Speed"}[e]||e}(e.stat.name),n=function(e){return{hp:"🧡",attack:"⚔️",defense:"🛡️","special-attack":"💥","special-defense":"✨",speed:"💨"}[e]||"📊"}(e.stat.name);return`\n                  <div class="stat-row">\n                    <span class="stat-label">${n} ${t}</span>\n                    <div class="bar-container">\n                      <div class="bar" style="width: ${Math.min(e.base_stat,150)}%">${e.base_stat}</div>\n                    </div>\n                  </div>\n                `})).join("")}\n            </div>\n          `,e.appendChild(a)}))}))}));const damageGrid=document.getElementById("damageGrid");fetch("https://pokeapi.co/api/v2/type").then((e=>e.json())).then((e=>{const t=e.results.filter((e=>!["shadow","unknown"].includes(e.name)));return Promise.all(t.map((e=>fetch(e.url).then((e=>e.json())).then((t=>({name:e.name,doubleTo:t.damage_relations.double_damage_to.map((e=>e.name)),doubleFrom:t.damage_relations.double_damage_from.map((e=>e.name)),halfFrom:t.damage_relations.half_damage_from.map((e=>e.name)),noFrom:t.damage_relations.no_damage_from.map((e=>e.name))}))))))})).then((e=>{e.forEach((e=>{const t=document.createElement("div");t.classList.add("type-relation-card"),t.innerHTML=`\n      <h3>${e.name}</h3>\n    \n      <p><strong>Deals double damage to:</strong></p>\n      <div class="relation-row">\n        ${e.doubleTo.map((e=>`<span class="type-badge ${e}">${e}</span>`)).join("")}\n      </div>\n    \n      <p><strong>Weak to:</strong></p>\n      <div class="relation-row">\n        ${e.doubleFrom.map((e=>`<span class="type-badge ${e}">${e}</span>`)).join("")}\n      </div>\n    \n      <p><strong>Resists:</strong></p>\n      <div class="relation-row">\n        ${e.halfFrom.map((e=>`<span class="type-badge ${e}">${e}</span>`)).join("")}\n      </div>\n    \n      <p><strong>Immune to:</strong></p>\n      <div class="relation-row">\n        ${e.noFrom.map((e=>`<span class="type-badge ${e}">${e}</span>`)).join("")}\n      </div>\n    `,damageGrid.appendChild(t)}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".mobile-menu-toggle"),t=document.querySelector(".nav-links");e&&t&&e.addEventListener("click",(()=>{t.classList.toggle("open"),e.classList.toggle("active")}))}));const pokemonRepository=function(){const e=[];let t=0;function n(e){return e.types?Promise.resolve():fetch(e.detailsUrl).then((e=>e.json())).then((t=>(e.height=`${(.328084*t.height).toFixed(1)} ft`,e.weight=`${(.220462*t.weight).toFixed(1)} lbs`,e.types=t.types.map((e=>e.type.name)),e.abilities=t.abilities.map((e=>e.ability.name)),e.baseStats=t.stats.map((e=>({name:e.stat.name,value:e.base_stat}))),e.id=t.id,fetch(t.species.url)))).then((e=>e.json())).then((t=>{const n=t.flavor_text_entries.find((e=>"en"===e.language.name)),a=t.genera.find((e=>"en"===e.language.name));e.description=n?n.flavor_text.replace(/\f/g," "):"No description available.",e.category=a?a.genus:"",e.genderRate=t.gender_rate,e.evolutionChainUrl=t.evolution_chain.url}))}return{getAll:function(){return e},loadList:function(){return e.length>0?Promise.resolve():fetch("https://pokeapi.co/api/v2/pokemon/?limit=1500").then((e=>e.json())).then((t=>t.results.forEach((t=>{var n;"object"==typeof(n={name:t.name,detailsUrl:t.url})&&"name"in n&&"detailsUrl"in n&&e.push(n)}))))},loadDetails:n,loadNextChunk:function(){const a=e.slice(t,t+150);return t+=a.length,Promise.all(a.map((e=>n(e)))).then((()=>a))},getOfficialArtworkUrl:function(e){return`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${function(e){const t=e.split("/");return t[t.length-2]}(e)}.png`}}}();function createTextLine(e,t){const n=document.createElement("p");return n.innerHTML=`<strong>${e}:</strong> ${t}`,n}function createStatBars(e){const t=document.createElement("div");return t.classList.add("stat-bars"),e.forEach((e=>{const n=document.createElement("div");n.classList.add("stat");const a=document.createElement("div");a.classList.add("label"),a.innerHTML=`<span>${e.name.toUpperCase()}</span><span>${e.value}</span>`;const o=document.createElement("div");o.classList.add("bar-container");const s=document.createElement("div");s.classList.add("bar"),s.style.width=`${Math.min(e.value,100)}%`,o.appendChild(s),n.appendChild(a),n.appendChild(o),t.appendChild(n)})),t}function getGenderIcons(e){if(-1===e)return"⚪ Genderless";const t=12.5*e;return`♂ ${100-t}% &nbsp;&nbsp; ♀ ${t}%`}function loadEvolutionChain(e){return fetch(e).then((e=>e.json())).then((e=>{const t=[];let n=e.chain;for(;n;)t.push({name:n.species.name}),n=n.evolves_to[0];return t}))}function displayPokemon(e,t=!1){const n=document.querySelector(".pokemon-grid");n&&(t&&(n.innerHTML=""),e.forEach((e=>{const t=document.createElement("div");t.classList.add("pokemon-card");const a=document.createElement("h3");a.textContent=e.name;const o=document.createElement("img");o.src=pokemonRepository.getOfficialArtworkUrl(e.detailsUrl),o.alt=e.name,o.classList.add("pokemon-image"),t.appendChild(a),t.appendChild(o),t.addEventListener("click",(()=>showDetails(e))),n.appendChild(t)})))}function showDetails(e){const t=document.getElementById("pokemon-modal"),n=t.querySelector(".modal-title"),a=t.querySelector(".modal-description"),o=t.querySelector(".modal-stats"),s=t.querySelector(".modal-image"),i=t.querySelector(".modal-category"),r=t.querySelector(".modal-gender"),d=t.querySelector(".modal-types"),c=t.querySelector(".modal-weaknesses"),l=t.querySelector(".modal-evolution");n.textContent=e.name,a.textContent=e.description,o.innerHTML="",s.innerHTML="",i.innerHTML="",r.innerHTML="",d.innerHTML="",c.innerHTML="",l.innerHTML="";const p=document.createElement("img");p.src=pokemonRepository.getOfficialArtworkUrl(e.detailsUrl),p.alt=e.name,p.classList.add("modal-pokemon-image"),s.appendChild(p),o.appendChild(document.createElement("hr")),o.appendChild(createTextLine("Height",e.height)),o.appendChild(createTextLine("Weight",e.weight)),o.appendChild(createTextLine("Abilities",e.abilities.join(", "))),e.category&&(i.textContent=`Category: ${e.category}`);const m=document.createElement("p");m.innerHTML=getGenderIcons(e.genderRate),r.appendChild(m),d.innerHTML="",e.types.forEach((e=>{const t=document.createElement("div");t.classList.add("type-badge",`type-${e.toLowerCase()}`),t.textContent=e.charAt(0).toUpperCase()+e.slice(1),d.appendChild(t)})),c.innerHTML="",fetch(`https://pokeapi.co/api/v2/type/${e.types[0]}`).then((e=>e.json())).then((e=>{e.damage_relations.double_damage_from.forEach((e=>{const t=document.createElement("div");t.classList.add("type-badge",`type-${e.name}`),t.textContent=e.name.charAt(0).toUpperCase()+e.name.slice(1),c.appendChild(t)}))})),o.appendChild(document.createElement("hr")),o.appendChild(createStatBars(e.baseStats)),l.innerHTML="",loadEvolutionChain(e.evolutionChainUrl).then((e=>{e.forEach((e=>{fetch(`https://pokeapi.co/api/v2/pokemon/${e.name}`).then((e=>e.json())).then((e=>{const t=document.createElement("div");t.classList.add("evolution-box"),t.style.cursor="pointer";const n=document.createElement("img");n.src=e.sprites.other["official-artwork"].front_default,n.alt=e.name;const a=document.createElement("span");a.textContent=e.name.charAt(0).toUpperCase()+e.name.slice(1),t.appendChild(n),t.appendChild(a),l.appendChild(t),t.addEventListener("click",(()=>{const t=document.querySelector(".modal-content");t.classList.remove("fade-in"),t.classList.add("fade-out"),setTimeout((()=>{pokemonRepository.loadDetails({name:e.name,detailsUrl:`https://pokeapi.co/api/v2/pokemon/${e.name}/`}).then((()=>{const n=pokemonRepository.getAll().find((t=>t.name===e.name));n&&showDetails(n),t.classList.remove("fade-out"),t.classList.add("fade-in")}))}),300)}))}))}))})),t.classList.remove("hidden")}function filterPokemon(e){const t=pokemonRepository.getAll();displayPokemon("all"===e?t:t.filter((t=>t.types&&t.types.includes(e))),!0)}function setupSearch(){const e=document.getElementById("searchInput");e&&e.addEventListener("input",(()=>{const t=e.value.toLowerCase().trim(),n=pokemonRepository.getAll().filter(((e,n)=>{const a=e.name.toLowerCase().includes(t),o=(n+1).toString()===t;return a||o})),a=n.map((e=>pokemonRepository.loadDetails(e)));Promise.all(a).then((()=>{displayPokemon(n,!0)}))}))}function loadAndRenderTypes(e=".type-grid"){console.log("✅ loadAndRenderTypes is running...");const t=document.querySelector(e);t&&fetch("https://pokeapi.co/api/v2/type").then((e=>e.json())).then((e=>{const t=e.results.filter((e=>!["shadow","unknown"].includes(e.name)));return Promise.all(t.map((e=>fetch(e.url).then((e=>e.json())).then((t=>({name:e.name,damageTo:t.damage_relations.double_damage_to.map((e=>e.name)),damageFrom:t.damage_relations.double_damage_from.map((e=>e.name)),examples:(t.pokemon||[]).slice(0,3).map((e=>capitalize(e.pokemon.name))),icon:getTypeIcon(e.name)}))))))})).then((e=>{console.log("📦 Types received:",e),e.forEach((e=>{const n=document.createElement("div");n.className=`type-card ${e.name}`,n.innerHTML=`\n          <div class="type-header">\n            <span class="icon">${e.icon}</span>\n            <h3>${capitalize(e.name)}</h3>\n          </div>\n          <div class="damage">\n            <p><strong>Strong against:</strong> ${e.damageTo.join(", ")||"—"}</p>\n            <p><strong>Weak against:</strong> ${e.damageFrom.join(", ")||"—"}</p>\n          </div>\n          <div class="examples">\n            <p><strong>Examples:</strong> ${e.examples.join(", ")}</p>\n          </div>\n        `,t.appendChild(n)}))})).catch(console.error)}function getTypeIcon(e){return{normal:"⚪",fire:"🔥",water:"💧",grass:"🌿",electric:"⚡",ice:"❄️",fighting:"🥊",poison:"☠️",ground:"🌍",flying:"🕊️",psychic:"🔮",bug:"🐛",rock:"🪨",ghost:"👻",dragon:"🐉",dark:"🌑",steel:"⚙️",fairy:"✨"}[e]||"❓"}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".close-button"),t=document.getElementById("pokemon-modal"),n=document.querySelectorAll(".type-btn");let a=!1;e&&e.addEventListener("click",(()=>t.classList.add("hidden"))),document.addEventListener("keydown",(e=>{["Escape","Enter"].includes(e.key)&&!t.classList.contains("hidden")&&t.classList.add("hidden")})),t.addEventListener("click",(e=>{e.target===t&&t.classList.add("hidden")}));const o=!document.body.classList.contains("types-page");function s(){a||(a=!0,pokemonRepository.loadNextChunk().then((e=>{displayPokemon(e),a=!1})))}o||"function"!=typeof loadAndRenderTypes||loadAndRenderTypes(),o&&("function"==typeof setupSearch&&setupSearch(),pokemonRepository.loadList().then((()=>{s(),window.addEventListener("scroll",(()=>{window.innerHeight+window.scrollY>=document.body.offsetHeight-100&&s()})),n.forEach((e=>{e.addEventListener("click",(()=>{filterPokemon(e.getAttribute("data-type"))}))}))})))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".main-scroll-area"),t=document.getElementById("backToTop");e&&t?(e.addEventListener("scroll",(()=>{e.scrollTop>400?t.classList.add("show"):t.classList.remove("show")})),t.addEventListener("click",(()=>{e.scrollTo({top:0,behavior:"smooth"})}))):console.error("❌ Scroll container or Back to Top button not found")})),setupSearch(),document.addEventListener("DOMContentLoaded",(()=>{loadAndRenderTypes()}));